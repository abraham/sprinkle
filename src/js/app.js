const seedPhotos = [
  {"id":"5sxQH0ugTaA","created_at":"2016-07-05T03:34:15-04:00","width":3000,"height":2000,"color":"#FFC17E","downloads":2462,"likes":129,"liked_by_user":false,"exif":{"make":"Canon","model":"Canon EOS 5DS R","exposure_time":"0.125","aperture":"4","focal_length":"20","iso":100},"location":{"city":"Värmdö","country":"Sweden","position":{"latitude":59.306416,"longitude":18.346467}},"current_user_collections":[],"urls":{"raw":"https://images.unsplash.com/photo-1467703834117-04386e3dadd8","full":"https://hd.unsplash.com/photo-1467703834117-04386e3dadd8","regular":"https://images.unsplash.com/photo-1467703834117-04386e3dadd8?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=1080\u0026fit=max\u0026s=1d9c52fe23e377c47ffa837e9745d0d3","small":"https://images.unsplash.com/photo-1467703834117-04386e3dadd8?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=400\u0026fit=max\u0026s=eafccd3329912a5cd92a9fccf8da3ff4","thumb":"https://images.unsplash.com/photo-1467703834117-04386e3dadd8?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=200\u0026fit=max\u0026s=afa637cc1aab9adb892f0c11fe500bb2"},"categories":[{"id":4,"title":"Nature","photo_count":54208,"links":{"self":"https://api.unsplash.com/categories/4","photos":"https://api.unsplash.com/categories/4/photos"}}],"links":{"self":"https://api.unsplash.com/photos/5sxQH0ugTaA","html":"http://unsplash.com/photos/5sxQH0ugTaA","download":"http://unsplash.com/photos/5sxQH0ugTaA/download","download_location":"https://api.unsplash.com/photos/5sxQH0ugTaA/download"},"user":{"id":"46rKBE69V4I","username":"andersjilden","name":"Anders Jildén","portfolio_url":"http://www.andersjilden.com","profile_image":{"small":"https://images.unsplash.com/profile-1457385257319-4e6a2fe89e66?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=32\u0026w=32\u0026s=98007ade7630749d4efc81513b51be0f","medium":"https://images.unsplash.com/profile-1457385257319-4e6a2fe89e66?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=64\u0026w=64\u0026s=f6644ee85e59506c4d7097be7f1d98dd","large":"https://images.unsplash.com/profile-1457385257319-4e6a2fe89e66?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=128\u0026w=128\u0026s=7a356e1ba6010b7946d16df484e974a6"},"links":{"self":"https://api.unsplash.com/users/andersjilden","html":"http://unsplash.com/@andersjilden","photos":"https://api.unsplash.com/users/andersjilden/photos","likes":"https://api.unsplash.com/users/andersjilden/likes","portfolio":"https://api.unsplash.com/users/andersjilden/portfolio"}}},
  {"id":"b-yEdfrvQ50","created_at":"2014-10-12T15:29:06-04:00","width":5184,"height":3456,"color":"#788887","downloads":5145,"likes":98,"liked_by_user":false,"exif":{"make":"Canon","model":"Canon EOS 60D","exposure_time":"1/80","aperture":"11.0","focal_length":"50/1","iso":200},"current_user_collections":[],"urls":{"raw":"https://images.unsplash.com/uploads/1413142095961484763cf/d141726c","full":"https://hd.unsplash.com/uploads/1413142095961484763cf/d141726c","regular":"https://images.unsplash.com/uploads/1413142095961484763cf/d141726c?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=1080\u0026fit=max\u0026s=8a9b4243b6c4839068414740b3a2de9e","small":"https://images.unsplash.com/uploads/1413142095961484763cf/d141726c?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=400\u0026fit=max\u0026s=cf01fa1b944963d1265d05719691d694","thumb":"https://images.unsplash.com/uploads/1413142095961484763cf/d141726c?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=200\u0026fit=max\u0026s=6e394a72cee937fd11bf3ad474f0e83c"},"categories":[{"id":4,"title":"Nature","photo_count":54208,"links":{"self":"https://api.unsplash.com/categories/4","photos":"https://api.unsplash.com/categories/4/photos"}}],"links":{"self":"https://api.unsplash.com/photos/b-yEdfrvQ50","html":"http://unsplash.com/photos/b-yEdfrvQ50","download":"http://unsplash.com/photos/b-yEdfrvQ50/download","download_location":"https://api.unsplash.com/photos/b-yEdfrvQ50/download"},"user":{"id":"_xatFNjMFGM","username":"gabrielssantiago","name":"Gabriel Santiago","portfolio_url":"http://whileimout.vsco.co","profile_image":{"small":"https://images.unsplash.com/profile-1460056671981-758694b3f290?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=32\u0026w=32\u0026s=674eaac06f92f34e24a91bdd3fa8fa72","medium":"https://images.unsplash.com/profile-1460056671981-758694b3f290?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=64\u0026w=64\u0026s=90b6fcebf8f17a810b9d4f250c98aa53","large":"https://images.unsplash.com/profile-1460056671981-758694b3f290?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=128\u0026w=128\u0026s=6ebef90b1c03ed509f83f62c6a29b7d8"},"links":{"self":"https://api.unsplash.com/users/gabrielssantiago","html":"http://unsplash.com/@gabrielssantiago","photos":"https://api.unsplash.com/users/gabrielssantiago/photos","likes":"https://api.unsplash.com/users/gabrielssantiago/likes","portfolio":"https://api.unsplash.com/users/gabrielssantiago/portfolio"}}},
  {"id":"p3OzJuT_Dks","created_at":"2016-04-22T01:01:40-04:00","width":4276,"height":2851,"color":"#DED4C3","downloads":17436,"likes":515,"liked_by_user":false,"exif":{"make":"FUJIFILM","model":"X100S","exposure_time":"3","aperture":"8","focal_length":"23","iso":200},"location":{"city":null,"country":"United States","position":{"latitude":36.2381316,"longitude":-121.8162251}},"current_user_collections":[],"urls":{"raw":"https://images.unsplash.com/photo-1461301214746-1e109215d6d3","full":"https://hd.unsplash.com/photo-1461301214746-1e109215d6d3","regular":"https://images.unsplash.com/photo-1461301214746-1e109215d6d3?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=1080\u0026fit=max\u0026s=bec5c903ed407ca6d014895d2529b5b9","small":"https://images.unsplash.com/photo-1461301214746-1e109215d6d3?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=400\u0026fit=max\u0026s=b4e9a7c6202d2d19a246df9b09657048","thumb":"https://images.unsplash.com/photo-1461301214746-1e109215d6d3?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026w=200\u0026fit=max\u0026s=6e8da39e0df5aecb7e885f1fa868f290"},"categories":[{"id":4,"title":"Nature","photo_count":54208,"links":{"self":"https://api.unsplash.com/categories/4","photos":"https://api.unsplash.com/categories/4/photos"}}],"links":{"self":"https://api.unsplash.com/photos/p3OzJuT_Dks","html":"http://unsplash.com/photos/p3OzJuT_Dks","download":"http://unsplash.com/photos/p3OzJuT_Dks/download","download_location":"https://api.unsplash.com/photos/p3OzJuT_Dks/download"},"user":{"id":"nsnweWvLNhg","username":"kace","name":"Kace  Rodriguez","portfolio_url":null,"profile_image":{"small":"https://images.unsplash.com/profile-1457542976429-b8ba80d8e423?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=32\u0026w=32\u0026s=53c0298e68277f5e4134cad4a35e5c2b","medium":"https://images.unsplash.com/profile-1457542976429-b8ba80d8e423?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=64\u0026w=64\u0026s=1711d36f781725ad2bde4780072eae97","large":"https://images.unsplash.com/profile-1457542976429-b8ba80d8e423?ixlib=rb-0.3.5\u0026q=80\u0026fm=jpg\u0026crop=faces\u0026cs=tinysrgb\u0026fit=crop\u0026h=128\u0026w=128\u0026s=503af45a5e77c00a7c8a68579be62462"},"links":{"self":"https://api.unsplash.com/users/kace","html":"http://unsplash.com/@kace","photos":"https://api.unsplash.com/users/kace/photos","likes":"https://api.unsplash.com/users/kace/likes","portfolio":"https://api.unsplash.com/users/kace/portfolio"}}}
];

const View = new class {
  get template() {
    return document.querySelector('#image-card');
  }
  get grid() {
    return document.querySelector('#images-list');
  }

  clearGrid() {
    this.grid.innerHTML = '';
  }

  showToast(message) {
    let toast = document.querySelector('#toast');
    toast.MaterialSnackbar.showSnackbar({ message: message });
  }

  renderImage(image) {
    let card = document.importNode(this.template.content, true);
    card.querySelector('.mdl-card').style.background = `url(${image.urls.small}) center / cover`
    card.querySelector('.image-card-image__author').innerText = image.user.name;
    card.querySelector('.image-card-image__download').setAttribute('href', image.links.download);
    card.querySelector('.image-card-image__download').addEventListener('click', this.onDownload);
    card.querySelector('.image-card-image__download').setAttribute('data-backup-download', image.urls.small);
    card.querySelector('.mdl-card__menu-open').setAttribute('href', image.links.html);
    this.grid.appendChild(card);
  }

  onDownload(event) {
    if (!navigator.onLine) {
      event.preventDefault();
      App.view.showToast('Downloading is disabled while offline');
    }
  }

  renderImages(images) {
    images.forEach(image => this.renderImage(image));
  }

  hideSupportCard() {
    if('serviceWorker' in navigator) {
      document.querySelector('.support-card').remove();
      console.log('[APP] Congrats, you appear to be using a modern browser.');
    }
  }
}

const UnsplashApi = new class {
  get apiHost() {
    return 'https://api.unsplash.com';
  }
  get clientId() {
    return '9df26b67b558143fa29670ab7d4f02e8a87dec739e20cc95d1dfac3553dc9bf2';
  }

  random() {
    return this.get('photos/random');
  }

  photos() {
    return this.get('photos', {per_page: 25});
  }

  get(path, params) {
    let init = {
      method: 'GET',
      headers: this.headers()
    }
    return fetch(this.constructUrl(path, params), init)
      .then(response => { return response.json() });
  }

  constructUrl(path, params) {
    return `${this.apiHost}/${path}${this.query(params)}`;
  }

  query(params) {
    if (params) {
      return '?' + Object.keys(params).map(k => `${encodeURIComponent(k)}=${encodeURIComponent(params[k])}`).join('&');
    } else {
      return '';
    }
  }

  headers() {
    return new Headers({
      'Authorization': `Client-ID ${this.clientId}`
    });
  }
}

const App = new class {
  get view() {
    return View;
  }
  get api() {
    return UnsplashApi;
  }

  init() {
    this.view.hideSupportCard();
    this.registerServiceWorker();
    this.view.renderImages(seedPhotos);
    this.api.photos().then(images => this.view.renderImages(images));
  }

  registerServiceWorker() {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('serviceworker.js')
        .then(registration => console.log('[APP] SW registered ', registration))
        .catch(error => console.log('[APP] SW registration failed', error));

      navigator.serviceWorker.addEventListener('message', function(event){
        console.log('[APP] Client 1 Received Message', event.data);
        // event.ports[0].postMessage("Client 1 Says 'Hello back!'");
      });
    }
  }
}

App.init();
